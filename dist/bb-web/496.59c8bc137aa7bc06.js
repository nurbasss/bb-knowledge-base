"use strict";(self.webpackChunkbb_web=self.webpackChunkbb_web||[]).push([[496],{2496:(Ot,A,a)=>{a.r(A),a.d(A,{CategoryModule:()=>y});var l=a(9900),h=a(8692),c=a(7553),m=a(4121),t=a(4537),f=a(7802),I=a(6943),T=a(8292),C=a(6618);function Y(n,o){if(1&n&&(t.TgZ(0,"ng-option",15),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",null==e?null:e.id),t.xp6(1),t.hij(" ",null==e?null:e.title," ")}}function z(n,o){if(1&n&&(t.TgZ(0,"div",4)(1,"p",5),t._uU(2,"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"),t.qZA(),t.TgZ(3,"ng-select",13),t.ALo(4,"async"),t.YNc(5,Y,2,2,"ng-option",14),t.qZA()()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("loading",t.lcZ(4,3,e.categoryService.isCategoryListLoading$)||!1)("searchable",!0),t.xp6(2),t.Q6J("ngForOf",e.categories)}}class b{constructor(o,e,i,s,r,u){this.route=o,this.fb=e,this.categoryService=i,this.toastr=s,this.router=r,this.changeDetector=u,this.type="category",this.isEdit=!1,this.categories=[],this.prefillCategoryId$=new m.X(null),this.tags=[{name:"\u0422\u044d\u0433 1"},{name:"\u0422\u044d\u0433 2"},{name:"\u0422\u044d\u0433 3"},{name:"\u0422\u044d\u0433 4"}],this.addNewTag=d=>({name:d}),this.form=this.fb.group({users:[null],title:[null,l.kI.required],description:[null],tags:[null],category:[null]})}ngOnInit(){this.route.queryParams.subscribe(o=>{o?.category&&this.prefillCategoryId$.next(o?.category)}),this.route.params.subscribe(o=>{this.type=o.type,this.editId=Number(o.id),this.router.url.split("/")[2].toString(),this.form.reset(),"subcategory"===this.type?(this.categoryService.getCategoryList(),this.categoryService.categoryList$.subscribe(i=>{this.categories=i,this.editId&&(this.isEdit=!0,this.edit()),i&&this.prefillCategoryId$.subscribe(s=>{s&&this.form.controls.category.setValue(Number(s))}),this.changeDetector.detectChanges()})):this.editId&&(this.isEdit=!0,this.edit())})}getTitle(){return"subcategory"===this.type?this.isEdit?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e":this.isEdit?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e"}onSubmitForm(){const o=()=>{(0,c.PE)("subcategory"===this.type?this.isEdit?"\u041f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0430":"\u041f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0430":this.isEdit?"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0430":"\u041a\u0430\u0442\u0435\u043e\u0433\u0440\u0438\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0430",this.toastr),this.categoryService.getCategoryList(),this.router.navigate(["/home"])};if("subcategory"===this.type){const e={title:this.form.controls.title.value,description:this.form.controls.description.value,category_id:this.form.controls.category.value,content:this.form.controls.description.value};this.isEdit?(e._method="PUT",this.categoryService.editSubcategory(e,this.editId).subscribe({next:o,error:i=>{(0,c.N3)(i,this.toastr)}})):this.categoryService.createSubcategory(e).subscribe({next:o,error:i=>{(0,c.N3)(i,this.toastr)}})}else{const e={title:this.form.controls.title.value,description:this.form.controls.description.value};this.isEdit?(e._method="PUT",this.categoryService.editCategory(e,this.editId).subscribe({next:o,error:i=>{(0,c.N3)(i,this.toastr)}})):this.categoryService.createCategory(e).subscribe({next:o,error:i=>{(0,c.N3)(i,this.toastr)}})}}edit(){this.editCategory="subcategory"===this.type?this.categoryService.getLocalSubcategoryById(this.editId):this.categoryService.getCategoryById(this.editId),this.form.controls.title.setValue(this.editCategory?.title),this.form.controls.description.setValue(this.editCategory?.description),"subcategory"===this.type&&this.form.controls.category.setValue(this.editCategory?.category_id),this.changeDetector.detectChanges()}}b.\u0275fac=function(o){return new(o||b)(t.Y36(f.gz),t.Y36(l.qu),t.Y36(I.H),t.Y36(T._W),t.Y36(f.F0),t.Y36(t.sBO))},b.\u0275cmp=t.Xpm({type:b,selectors:[["bb-create-category"]],decls:19,vars:4,consts:[[1,"container-wrapper"],[1,"create-category",3,"formGroup"],[1,"create-category__title","mb_24"],[1,"row","mb_24"],[1,"col-6"],[1,"create-category__subtitle"],["type","text","placeholder","\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","id","floatingTitle","formControlName","title",1,"form-control","base-input"],["class","col-6",4,"ngIf"],[1,"row"],[1,"col-12"],["formControlName","description","id","","rows","3",1,"form-control","base-input"],[1,"create-category__footer"],[1,"_btn","btn-success","create-btn",3,"click"],["formControlName","category","placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e","dropdownPosition","bottom","notFoundText","\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e",1,"base-select",3,"loading","searchable"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3),t.qZA(),t._UZ(4,"div",3),t.TgZ(5,"div",3)(6,"div",4)(7,"p",5),t._uU(8,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"),t.qZA(),t._UZ(9,"input",6),t.qZA(),t.YNc(10,z,6,5,"div",7),t.qZA(),t.TgZ(11,"div",8)(12,"div",9)(13,"p",5),t._uU(14,"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 (\u043d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e)"),t.qZA(),t._UZ(15,"textarea",10),t.qZA()(),t.TgZ(16,"div",11)(17,"button",12),t.NdJ("click",function(){return e.onSubmitForm()}),t._uU(18),t.qZA()()()()),2&o&&(t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(2),t.Oqu(e.getTitle()),t.xp6(7),t.Q6J("ngIf","subcategory"===e.type),t.xp6(8),t.hij(" ",e.isEdit?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"," "))},dependencies:[h.sg,h.O5,l.Fj,l.JJ,l.JL,l.sg,l.u,C.w9,C.jq,h.Ov],styles:[".create-category__title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#152536;letter-spacing:.02em}.create-category__subtitle[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#152536cc;letter-spacing:.02em;margin-bottom:12px}.create-category__footer[_ngcontent-%COMP%]{margin-top:40px;display:flex;justify-content:flex-end}.create-category__footer[_ngcontent-%COMP%]   .create-btn[_ngcontent-%COMP%]{height:40px;width:auto}"]});var K=a(7894),Q=a(3151),G=a(2147),Z=a(1067),O=a(9923);function H(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"th",15)(2,"input",16),t.NdJ("click",function(){const r=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.selectVar(r))}),t.qZA()(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA()()}if(2&n){const e=o.$implicit,i=o.index;t.xp6(2),t.Q6J("id",i),t.xp6(2),t.hij(" ",e.category_name," "),t.xp6(2),t.Oqu(e.sub_category_name),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.value)}}class w{constructor(o,e,i){this.activeModal=o,this.variableService=e,this.changeDetector=i,this.variablesList=[],this.allVariables=[],this.searchString=new l.NI}ngOnInit(){this.variableService.variablesList$.subscribe(o=>{this.allVariables=[...o],this.variablesList=[...o],this.changeDetector.detectChanges(),this.changeDetector.detectChanges()}),this.subscribeSearch()}close(){this.activeModal.close()}sendSelected(){this.activeModal.close(this.selectedVariable)}selectVar(o){this.selectedVariable=o}onKeyPress(o){}subscribeSearch(){this.searchString.valueChanges.pipe((0,Q.b)(800),(0,G.x)()).subscribe(o=>{o?(this.variablesList=this.allVariables.filter(e=>e?.name?.toLowerCase().includes(o?.toLowerCase())||e?.value?.toLowerCase()===o?.toLowerCase()),this.changeDetector.detectChanges()):(this.variablesList=[...this.allVariables],this.changeDetector.detectChanges())})}}w.\u0275fac=function(o){return new(o||w)(t.Y36(Z.Kz),t.Y36(O.S),t.Y36(t.sBO))},w.\u0275cmp=t.Xpm({type:w,selectors:[["bb-variable-modal"]],decls:29,vars:2,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"search"],[1,"search__left"],[1,"search__icon"],["src","./assets/icons/search.svg","alt","search"],["type","text","placeholder","\u041f\u043e\u0438\u0441\u043a",1,"search__input",3,"formControl","change"],["searchInput",""],[1,"table","table-striped"],["scope","col"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"_btn","btn-success","variable-button",3,"click"],["scope","row"],["type","radio","name","nems",3,"id","click"]],template:function(o,e){if(1&o){const i=t.EpF();t.TgZ(0,"div",0)(1,"h4",1),t._uU(2,"\u0412\u044b\u0431\u043e\u0440 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439"),t.qZA(),t.TgZ(3,"button",2),t.NdJ("click",function(){return e.activeModal.dismiss("Cross click")}),t.qZA()(),t.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6),t._UZ(8,"img",7),t.qZA(),t.TgZ(9,"input",8,9),t.NdJ("change",function(){t.CHM(i);const r=t.MAs(10);return t.KtG(r.value=r.value.trim())}),t.qZA()()(),t.TgZ(11,"div")(12,"table",10)(13,"thead")(14,"tr"),t._UZ(15,"th",11),t.TgZ(16,"th",11),t._uU(17,"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"),t.qZA(),t.TgZ(18,"th",11),t._uU(19,"\u041f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"),t.qZA(),t.TgZ(20,"th",11),t._uU(21,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),t.qZA(),t.TgZ(22,"th",11),t._uU(23,"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435"),t.qZA()()(),t.TgZ(24,"tbody"),t.YNc(25,H,11,5,"tr",12),t.qZA()()()(),t.TgZ(26,"div",13)(27,"button",14),t.NdJ("click",function(){return e.sendSelected()}),t._uU(28," \u0412\u044b\u0431\u043e\u0440 "),t.qZA()()}2&o&&(t.xp6(9),t.Q6J("formControl",e.searchString),t.xp6(16),t.Q6J("ngForOf",e.variablesList))},dependencies:[h.sg,l.Fj,l.JJ,l.oH],styles:[".modal-header[_ngcontent-%COMP%]{border-bottom:none;padding:24px}.search[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 24px 8px 16px;border-radius:12px;background-color:#f3f3f3;max-width:250px;align-items:center;position:relative;margin-bottom:16px}.search__left[_ngcontent-%COMP%]{display:flex;align-items:center}.search__icon[_ngcontent-%COMP%]{width:24px;height:24px;margin-right:8px}.search__text[_ngcontent-%COMP%]{font-weight:500;font-size:14px;color:#152536}.search__input[_ngcontent-%COMP%]{width:100%;max-width:242px;border:none;background-color:transparent;outline:none;padding-right:8px;font-size:14px;font-weight:500;color:#152536}.variable-button[_ngcontent-%COMP%]{max-width:120px;height:40px}input[type=radio][_ngcontent-%COMP%]{height:20px;width:20px;margin:auto 0}input[type=radio][_ngcontent-%COMP%]:after{border-color:#50c55a;background-color:#50c55a}"]});var P=a(8023);class X extends P.x{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(o){const{hasError:e,_hasValue:i,_value:s,thrownError:r,isStopped:u,_isComplete:d}=this;e?o.error(r):(u||d)&&(i&&o.next(s),o.complete())}next(o){this.isStopped||(this._value=o,this._hasValue=!0)}complete(){const{_hasValue:o,_value:e,_isComplete:i}=this;i||(this._isComplete=!0,o&&super.next(e),super.complete())}}var W=a(9676),tt=a(3891),U=a(4135);class x{constructor(o,e,i){this.postService=o,this.activeModal=e,this.toastr=i,this.file=null}close(){this.activeModal.close()}onFilechange(o){this.file=o.target.files[0]}upload(){this.file?this.postService.uploadImage(this.file).subscribe({next:o=>{this.activeModal.close(o?.images?.url)},error:o=>{(0,c.N3)(o,this.toastr)}}):(0,c.gD)("\u0424\u0430\u0439\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d",this.toastr)}}x.\u0275fac=function(o){return new(o||x)(t.Y36(U.L),t.Y36(Z.Kz),t.Y36(T._W))},x.\u0275cmp=t.Xpm({type:x,selectors:[["bb-image-upload"]],decls:14,vars:0,consts:[[1,"modal-header"],[1,"modal__title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-md-4"],[1,"mb-3"],["for","formFile",1,"form-label"],["type","file","id","formFile",1,"form-control",3,"change"],["type","button",1,"btn","btn-primary","mt-3",3,"click"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"h4",1),t._uU(2,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"),t.qZA(),t.TgZ(3,"button",2),t.NdJ("click",function(){return e.close()}),t.qZA()(),t.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),t._uU(10,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"),t.qZA(),t.TgZ(11,"input",9),t.NdJ("change",function(s){return e.onFilechange(s)}),t.qZA(),t.TgZ(12,"button",10),t.NdJ("click",function(){return e.upload()}),t._uU(13," \u0412\u044b\u0431\u0440\u0430\u0442\u044c "),t.qZA()()()()()())}});var F=a(4581),et=a(3072),B=a(3528),ot=a(5598),nt=a(116),it=a(2069);class st extends P.x{constructor(o=1/0,e=1/0,i=it.l){super(),this._bufferSize=o,this._windowTime=e,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,o),this._windowTime=Math.max(1,e)}next(o){const{isStopped:e,_buffer:i,_infiniteTimeWindow:s,_timestampProvider:r,_windowTime:u}=this;e||(i.push(o),!s&&i.push(r.now()+u)),this._trimBuffer(),super.next(o)}_subscribe(o){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(o),{_infiniteTimeWindow:i,_buffer:s}=this,r=s.slice();for(let u=0;u<r.length&&!o.closed;u+=i?1:2)o.next(r[u]);return this._checkFinalizedStatuses(o),e}_trimBuffer(){const{_bufferSize:o,_timestampProvider:e,_buffer:i,_infiniteTimeWindow:s}=this,r=(s?1:2)*o;if(o<1/0&&r<i.length&&i.splice(0,i.length-r),!s){const u=e.now();let d=0;for(let v=1;v<i.length&&i[v]<=u;v+=2)d=v;d&&i.splice(0,d+1)}}}var rt=a(815);function lt(n,o){}const E=()=>{const n=typeof window<"u"?window:void 0;return n&&n.tinymce?n.tinymce:null};let ut=(()=>{class n{constructor(){this.onBeforePaste=new t.vpe,this.onBlur=new t.vpe,this.onClick=new t.vpe,this.onContextMenu=new t.vpe,this.onCopy=new t.vpe,this.onCut=new t.vpe,this.onDblclick=new t.vpe,this.onDrag=new t.vpe,this.onDragDrop=new t.vpe,this.onDragEnd=new t.vpe,this.onDragGesture=new t.vpe,this.onDragOver=new t.vpe,this.onDrop=new t.vpe,this.onFocus=new t.vpe,this.onFocusIn=new t.vpe,this.onFocusOut=new t.vpe,this.onKeyDown=new t.vpe,this.onKeyPress=new t.vpe,this.onKeyUp=new t.vpe,this.onMouseDown=new t.vpe,this.onMouseEnter=new t.vpe,this.onMouseLeave=new t.vpe,this.onMouseMove=new t.vpe,this.onMouseOut=new t.vpe,this.onMouseOver=new t.vpe,this.onMouseUp=new t.vpe,this.onPaste=new t.vpe,this.onSelectionChange=new t.vpe,this.onActivate=new t.vpe,this.onAddUndo=new t.vpe,this.onBeforeAddUndo=new t.vpe,this.onBeforeExecCommand=new t.vpe,this.onBeforeGetContent=new t.vpe,this.onBeforeRenderUI=new t.vpe,this.onBeforeSetContent=new t.vpe,this.onChange=new t.vpe,this.onClearUndos=new t.vpe,this.onDeactivate=new t.vpe,this.onDirty=new t.vpe,this.onExecCommand=new t.vpe,this.onGetContent=new t.vpe,this.onHide=new t.vpe,this.onInit=new t.vpe,this.onInitNgModel=new t.vpe,this.onLoadContent=new t.vpe,this.onNodeChange=new t.vpe,this.onPostProcess=new t.vpe,this.onPostRender=new t.vpe,this.onPreInit=new t.vpe,this.onPreProcess=new t.vpe,this.onProgressState=new t.vpe,this.onRedo=new t.vpe,this.onRemove=new t.vpe,this.onReset=new t.vpe,this.onResizeEditor=new t.vpe,this.onSaveContent=new t.vpe,this.onSetAttrib=new t.vpe,this.onObjectResizeStart=new t.vpe,this.onObjectResized=new t.vpe,this.onObjectSelected=new t.vpe,this.onSetContent=new t.vpe,this.onShow=new t.vpe,this.onSubmit=new t.vpe,this.onUndo=new t.vpe,this.onVisualAid=new t.vpe}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=t.lG2({type:n,outputs:{onBeforePaste:"onBeforePaste",onBlur:"onBlur",onClick:"onClick",onContextMenu:"onContextMenu",onCopy:"onCopy",onCut:"onCut",onDblclick:"onDblclick",onDrag:"onDrag",onDragDrop:"onDragDrop",onDragEnd:"onDragEnd",onDragGesture:"onDragGesture",onDragOver:"onDragOver",onDrop:"onDrop",onFocus:"onFocus",onFocusIn:"onFocusIn",onFocusOut:"onFocusOut",onKeyDown:"onKeyDown",onKeyPress:"onKeyPress",onKeyUp:"onKeyUp",onMouseDown:"onMouseDown",onMouseEnter:"onMouseEnter",onMouseLeave:"onMouseLeave",onMouseMove:"onMouseMove",onMouseOut:"onMouseOut",onMouseOver:"onMouseOver",onMouseUp:"onMouseUp",onPaste:"onPaste",onSelectionChange:"onSelectionChange",onActivate:"onActivate",onAddUndo:"onAddUndo",onBeforeAddUndo:"onBeforeAddUndo",onBeforeExecCommand:"onBeforeExecCommand",onBeforeGetContent:"onBeforeGetContent",onBeforeRenderUI:"onBeforeRenderUI",onBeforeSetContent:"onBeforeSetContent",onChange:"onChange",onClearUndos:"onClearUndos",onDeactivate:"onDeactivate",onDirty:"onDirty",onExecCommand:"onExecCommand",onGetContent:"onGetContent",onHide:"onHide",onInit:"onInit",onInitNgModel:"onInitNgModel",onLoadContent:"onLoadContent",onNodeChange:"onNodeChange",onPostProcess:"onPostProcess",onPostRender:"onPostRender",onPreInit:"onPreInit",onPreProcess:"onPreProcess",onProgressState:"onProgressState",onRedo:"onRedo",onRemove:"onRemove",onReset:"onReset",onResizeEditor:"onResizeEditor",onSaveContent:"onSaveContent",onSetAttrib:"onSetAttrib",onObjectResizeStart:"onObjectResizeStart",onObjectResized:"onObjectResized",onObjectSelected:"onObjectSelected",onSetContent:"onSetContent",onShow:"onShow",onSubmit:"onSubmit",onUndo:"onUndo",onVisualAid:"onVisualAid"}}),n})();const N=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onResizeEditor","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],M=(n,o,e)=>(0,F.R)(n,o).pipe((0,B.R)(e)),L=(n,o)=>"string"==typeof n?n.split(",").map(e=>e.trim()):Array.isArray(n)?n:o;let k=0;const V=n=>typeof n<"u"&&"textarea"===n.tagName.toLowerCase(),q=n=>typeof n>"u"||""===n?[]:Array.isArray(n)?n:n.split(" "),ht=(n,o)=>q(n).concat(q(o)),pt=()=>{},J=n=>null==n,mt=(()=>{let n={script$:null};return{load:(i,s)=>n.script$||(n.script$=(0,et.P)(()=>{const r=i.createElement("script");return r.referrerPolicy="origin",r.type="application/javascript",r.src=s,i.head.appendChild(r),(0,F.R)(r,"load").pipe((0,ot.q)(1),(0,nt.h)(void 0))}).pipe(function at(n,o,e){let i,s=!1;return n&&"object"==typeof n?({bufferSize:i=1/0,windowTime:o=1/0,refCount:s=!1,scheduler:e}=n):i=n??1/0,(0,rt.B)({connector:()=>new st(i,o,e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})}({bufferSize:1,refCount:!0}))),reinitialize:()=>{n={script$:null}}}})(),ft=new t.OlP("TINYMCE_SCRIPT_SRC"),bt={provide:l.JU,useExisting:(0,t.Gpc)(()=>D),multi:!0};let D=(()=>{class n extends ut{constructor(e,i,s,r){super(),this.platformId=s,this.tinymceScriptSrc=r,this.cloudChannel="6",this.apiKey="no-api-key",this.id="",this.modelEvents="change input undo redo",this.onTouchedCallback=pt,this.destroy$=new P.x,this.initialise=()=>{const u={...this.init,selector:void 0,target:this._element,inline:this.inline,readonly:this.disabled,plugins:ht(this.init&&this.init.plugins,this.plugins),toolbar:this.toolbar||this.init&&this.init.toolbar,setup:d=>{this._editor=d,M(d,"init",this.destroy$).subscribe(()=>{this.initEditor(d)}),((n,o,e)=>{(n=>{const o=L(n.ignoreEvents,[]);return L(n.allowedEvents,N).filter(i=>N.includes(i)&&!o.includes(i))})(n).forEach(s=>{const r=n[s];M(o,s.substring(2),e).subscribe(u=>{r.observers.length>0&&n.ngZone.run(()=>r.emit({event:u,editor:o}))})})})(this,d,this.destroy$),this.init&&"function"==typeof this.init.setup&&this.init.setup(d)}};V(this._element)&&(this._element.style.visibility=""),this.ngZone.runOutsideAngular(()=>{E().init(u)})},this._elementRef=e,this.ngZone=i}set disabled(e){this._disabled=e,this._editor&&this._editor.initialized&&("function"==typeof this._editor.mode?.set?this._editor.mode.set(e?"readonly":"design"):this._editor.setMode(e?"readonly":"design"))}get disabled(){return this._disabled}get editor(){return this._editor}writeValue(e){this._editor&&this._editor.initialized?this._editor.setContent(J(e)?"":e):this.initialValue=null===e?void 0:e}registerOnChange(e){this.onChangeCallback=e}registerOnTouched(e){this.onTouchedCallback=e}setDisabledState(e){this.disabled=e}ngAfterViewInit(){(0,h.NF)(this.platformId)&&(this.id=this.id||(n=>{const e=(new Date).getTime(),i=Math.floor(1e9*Math.random());return k++,"tiny-angular_"+i+k+String(e)})(),this.inline=void 0!==this.inline?!1!==this.inline:!!this.init?.inline,this.createElement(),null!==E()?this.initialise():this._element&&this._element.ownerDocument&&mt.load(this._element.ownerDocument,this.getScriptSrc()).pipe((0,B.R)(this.destroy$)).subscribe(this.initialise))}ngOnDestroy(){this.destroy$.next(),null!==E()&&E().remove(this._editor)}createElement(){this._element=document.createElement(this.inline?"string"==typeof this.tagName?this.tagName:"div":"textarea"),this._element&&(document.getElementById(this.id)&&console.warn(`TinyMCE-Angular: an element with id [${this.id}] already exists. Editors with duplicate Id will not be able to mount`),this._element.id=this.id,V(this._element)&&(this._element.style.visibility="hidden"),this._elementRef.nativeElement.appendChild(this._element))}getScriptSrc(){return J(this.tinymceScriptSrc)?`https://cdn.tiny.cloud/1/${this.apiKey}/tinymce/${this.cloudChannel}/tinymce.min.js`:this.tinymceScriptSrc}initEditor(e){M(e,"blur",this.destroy$).subscribe(()=>{this.ngZone.run(()=>this.onTouchedCallback())}),M(e,this.modelEvents,this.destroy$).subscribe(()=>{this.ngZone.run(()=>this.emitOnChange(e))}),"string"==typeof this.initialValue&&this.ngZone.run(()=>{e.setContent(this.initialValue),e.getContent()!==this.initialValue&&this.emitOnChange(e),void 0!==this.onInitNgModel&&this.onInitNgModel.emit(e)})}emitOnChange(e){this.onChangeCallback&&this.onChangeCallback(e.getContent({format:this.outputFormat}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(t.R0b),t.Y36(t.Lbi),t.Y36(ft,8))},n.\u0275cmp=t.Xpm({type:n,selectors:[["editor"]],inputs:{cloudChannel:"cloudChannel",apiKey:"apiKey",init:"init",id:"id",initialValue:"initialValue",outputFormat:"outputFormat",inline:"inline",tagName:"tagName",plugins:"plugins",toolbar:"toolbar",modelEvents:"modelEvents",allowedEvents:"allowedEvents",ignoreEvents:"ignoreEvents",disabled:"disabled"},standalone:!0,features:[t._Bn([bt]),t.qOj,t.jDz],decls:1,vars:0,template:function(e,i){1&e&&t.YNc(0,lt,0,0,"ng-template")},dependencies:[h.ez,l.u5],styles:["[_nghost-%COMP%]{display:block}"]}),n})(),_t=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[D]}),n})();var R=a(605);function yt(n,o){if(1&n&&(t.TgZ(0,"ng-option",22),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.title," ")}}function vt(n,o){if(1&n&&(t.TgZ(0,"ng-option",22),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.title," ")}}class _ extends K.A{constructor(o,e,i,s,r,u,d,v,At){super(),this.fb=o,this.modalService=e,this.changeDetector=i,this.categoryService=s,this.variableService=r,this.postService=u,this.toastr=d,this.route=v,this.router=At,this.showChooseVariableModal$=new m.X(!1),this.showAddVariableModal$=new m.X(!1),this.showImageUploadModal$=new m.X(!1),this.dataToInsert=new m.X(""),this.editorData="",this.variables=[],this.subcategories=[],this.usedVariableIds=[],this.type="create",this.isEditPostLoading=!1,this.prefillCategory$=new m.X(null),this.prefillSubCategory$=new m.X(null),this.editorSubject=new X,this.tags=[{name:"\u0422\u044d\u0433 1"},{name:"\u0422\u044d\u0433 2"},{name:"\u0422\u044d\u0433 3"},{name:"\u0422\u044d\u0433 4"}],this.init={content_style:".variable { background-color: yellow; }",height:500,extended_valid_elements:"bb-variable[*]",invalid_elements:"strong,b,em,i",menubar:"edit view format tools table help",plugins:["table","image","advlist","lists","charmap","preview","anchor","pagebreak","code"],toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | outdent indent | bullist numlist | imageButton | chooseVariableButton | addVariableButton |",setup:p=>{this.editor=p,p.ui.registry.addButton("chooseVariableButton",{text:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e",onAction:()=>{this.showChooseVariableModal$.next(!0),this.dataToInsert.next(""),this.dataToInsertSubscription&&this.dataToInsertSubscription.unsubscribe(),this.dataToInsertSubscription=this.dataToInsert.subscribe(g=>{g&&p.insertContent(g)})}}),p.ui.registry.addButton("addVariableButton",{text:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e",onAction:()=>{this.showAddVariableModal$.next(!0),this.dataToInsert.next(""),this.dataToInsertSubscription&&this.dataToInsertSubscription.unsubscribe(),this.dataToInsertSubscription=this.dataToInsert.subscribe(g=>{g&&p.insertContent(g)})}}),p.ui.registry.addButton("imageButton",{icon:"image",onAction:()=>{this.showImageUploadModal$.next(!0),this.dataToInsert.next(""),this.dataToInsertSubscription&&this.dataToInsertSubscription.unsubscribe(),this.dataToInsertSubscription=this.dataToInsert.subscribe(g=>{g&&p.insertContent(g)})}}),p.on("keydown",g=>{if(13==g.keyCode&&g.shiftKey)return g.preventDefault(),void g.stopPropagation();13===g.keyCode&&p.insertContent("<br>")})}},this.addNewTag=p=>({name:p}),this.form=this.fb.group({title:[null,l.kI.required],category:[null,l.kI.required],subcategory:[null,l.kI.required],postTags:[null],editorContent:[null,l.kI.required]})}onEditorInit(o){console.log(o),this.editorSubject.next(o.editor),this.editorSubject.complete()}ngOnDestroy(){this.prefillSubCategory$.next(null),this.prefillCategory$.next(null),this.prefillSubscription&&this.prefillSubscription.unsubscribe(),this.unsubscribeAll()}ngOnInit(){this.showChooseVariableModal$.subscribe(o=>{o&&document.getElementById("choose")?.click()}),this.showAddVariableModal$.subscribe(o=>{o&&document.getElementById("add")?.click()}),this.showImageUploadModal$.subscribe(o=>{o&&document.getElementById("imageUpload")?.click()}),this.variableService.getAllVariables(),this.categoryService.getCategoryList(),this.route.params.subscribe(o=>{this.type=o.action,"edit"===this.type&&(this.postId=o.id,this.getPostById())}),this.addSubscriber(this.route.queryParams.pipe((0,W.P)()).subscribe(o=>{const e=o?.category,i=o?.subcategory;this.prefillCategory$.next(e),this.prefillSubCategory$.next(i),this.changeDetector.detectChanges()})),this.addSubscriber(this.categoryService.categoryList$.subscribe(o=>{o&&(this.prefillSubscription=this.prefillCategory$.subscribe(e=>{e&&(this.form.controls.category.setValue(this.categoryService.getCategoryById(e)),this.onCategoryChange(this.form.controls.category.value),this.form.controls.subcategory.setValue(this.categoryService.getLocalSubcategoryById(this.prefillSubCategory$.value)),this.changeDetector.detectChanges())}))}))}handler(){}openChooseVariableModal(){this.modalService.open(w,{scrollable:!0,modalDialogClass:"mw-740",centered:!0}).result.then(e=>{e&&this.dataToInsert.next(`&nbsp;<bb-variable class="variable mceNonEditable" var="${e.id}">${e.value}</bb-variable>&nbsp;`)})}handleVariables(o){this.usedVariableIds=[];const e=/<bb-variable\s+class="([^"]+)"\s+var="([^"]+)">([^<]+)<\/bb-variable>/g;let i;for(;null!==(i=e.exec(o));){const s=Number(i[2]);this.usedVariableIds.includes(s)||this.usedVariableIds.push(s)}}openAddVariableModal(){this.modalService.open(tt.d,{modalDialogClass:"mw-740 mh-600",centered:!0}).result.then(e=>{e&&(this.dataToInsert.next(`&nbsp;<bb-variable class="variable mceNonEditable"  var="${e.id}" >${e.value}</bb-variable>&nbsp;`),this.variableService.getAllVariables())})}onCategoryChange(o){this.subcategories=[],this.form.controls.subcategory.setValue(null),o&&(this.subcategories=o.sub_categories),this.changeDetector.detectChanges()}onFormSubmit(){if(this.form.valid){const o=this.form.controls.editorContent.value;this.handleVariables(o);let e={title:this.form.controls.title.value,description:o.replace(/<[^>]*>/g,"").slice(0,250)||" ",content:o,sub_category_id:this.form.controls.subcategory.value.id,variable_ids:this.usedVariableIds};"edit"===this.type&&this.editPost?(e._method="PUT",this.postService.updatePost(e,this.postId).subscribe({next:i=>{(0,c.PE)("\u041f\u043e\u0441\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d",this.toastr),this.router.navigate(i?.posts?.id?["posts/post/"+i?.posts?.id]:["home"])}})):this.postService.createPost(e).subscribe({next:i=>{(0,c.PE)("\u041f\u043e\u0441\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d",this.toastr),this.router.navigate(i?.posts?.id?["posts/post/"+i?.posts?.id]:["home"])},error:i=>{(0,c.N3)(i,this.toastr)}})}else(0,c.Ss)(this.form,this.toastr)}getPostById(){this.isEditPostLoading=!0,this.changeDetector.detectChanges(),this.postService.getPostById(this.postId).subscribe({next:o=>{this.editPost=o.posts,this.prefillCategory$.next(this.editPost?.sub_category_id),this.form.controls.editorContent.setValue(this.editPost?.content),this.form.controls.title.setValue(this.editPost?.title),this.form.controls.category.setValue(this.categoryService.getCategoryBySubcateryId(this.editPost?.sub_category_id)),this.onCategoryChange(this.form.controls.category.value),this.form.controls.subcategory.setValue(this.categoryService.getLocalSubcategoryById(this.editPost.sub_category_id)),this.isEditPostLoading=!1,this.changeDetector.detectChanges()},error:o=>{(0,c.N3)(o,this.toastr),this.isEditPostLoading=!1,this.changeDetector.detectChanges()}})}openImageUploadModal(){this.modalService.open(x,{centered:!0}).result.then(e=>{if(e){const r=`<img width="400px" src="http://${e.replaceAll("//","/")}" />`;this.dataToInsert.next(r),this.variableService.getAllVariables()}})}}_.\u0275fac=function(o){return new(o||_)(t.Y36(l.qu),t.Y36(Z.FF),t.Y36(t.sBO),t.Y36(I.H),t.Y36(O.S),t.Y36(U.L),t.Y36(T._W),t.Y36(f.gz),t.Y36(f.F0))},_.\u0275cmp=t.Xpm({type:_,selectors:[["bb-create-post"]],features:[t.qOj],decls:38,vars:16,consts:[[1,"container-wrapper",3,"formGroup"],[1,"create-post"],[1,"create-post__title"],["id","choose",2,"display","none",3,"click"],["id","add",2,"display","none",3,"click"],["id","imageUpload",2,"display","none",3,"click"],[1,"create-post__subtitle"],[1,"col-12","mb_16"],[1,"form-floating"],["type","text","id","title","formControlName","title","placeholder","\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",1,"form-control","base-input"],["for","title"],[1,"row"],[1,"col-6","mb_24"],[1,"modal__subtitle"],["formControlName","category","placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e","id","category","dropdownPosition","bottom","notFoundText","\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e",1,"base-select",3,"loading","searchable","change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","subcategory","placeholder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e","id","subcategory","dropdownPosition","bottom","notFoundText","\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e",1,"base-select",3,"searchable"],[3,"loading"],[1,"create-post__editor"],["apiKey","jk8cihs8koq4u4ir3ja4r0so6wihe0qlqyazbw4wxp5tzlvm","initialValue","","formControlName","editorContent",3,"init","onInit"],[1,"create-post__footer"],[1,"_btn","btn-success","create-post__button",3,"click"],[3,"value"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"p",2),t._uU(3),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return e.openChooseVariableModal()}),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){return e.openAddVariableModal()}),t.qZA(),t.TgZ(7,"button",5),t.NdJ("click",function(){return e.openImageUploadModal()}),t._uU(8," > "),t.qZA(),t.TgZ(9,"p",6),t._uU(10,"\u0414\u0435\u0442\u0430\u043b\u0438 \u043f\u043e\u0441\u0442\u0430"),t.qZA(),t.TgZ(11,"div",7)(12,"div",8),t._UZ(13,"input",9),t.TgZ(14,"label",10),t._uU(15,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"),t.qZA()()(),t.TgZ(16,"div",11)(17,"div",12)(18,"p",13),t._uU(19,"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"),t.qZA(),t.TgZ(20,"ng-select",14),t.NdJ("change",function(s){return e.onCategoryChange(s)}),t.ALo(21,"async"),t.YNc(22,yt,2,2,"ng-option",15),t.ALo(23,"async"),t.qZA()(),t.TgZ(24,"div",12)(25,"p",13),t._uU(26,"\u041f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"),t.qZA(),t.TgZ(27,"ng-select",16),t.YNc(28,vt,2,2,"ng-option",15),t.qZA()()()()(),t.TgZ(29,"p",6),t._uU(30,"\u0422\u0435\u043a\u0441\u0442 \u043f\u043e\u0441\u0442\u0430"),t.qZA(),t._UZ(31,"bb-loader",17),t.ALo(32,"async"),t.TgZ(33,"div",18)(34,"editor",19),t.NdJ("onInit",function(s){return e.onEditorInit(s)}),t.qZA()(),t.TgZ(35,"div",20)(36,"button",21),t.NdJ("click",function(){return e.onFormSubmit()}),t._uU(37),t.qZA()()()),2&o&&(t.Q6J("formGroup",e.form),t.xp6(3),t.hij(" ","edit"===e.type?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u043e\u0441\u0442":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u0441\u0442"," "),t.xp6(17),t.Q6J("loading",t.lcZ(21,10,e.categoryService.isCategoryListLoading$))("searchable",!0),t.xp6(2),t.Q6J("ngForOf",t.lcZ(23,12,e.categoryService.categoryListObserver$)),t.xp6(5),t.Q6J("searchable",!0),t.xp6(1),t.Q6J("ngForOf",e.subcategories),t.xp6(3),t.Q6J("loading",null===t.lcZ(32,14,e.editorSubject)),t.xp6(3),t.Q6J("init",e.init),t.xp6(3),t.hij(" ","edit"===e.type?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"," "))},dependencies:[h.sg,l.Fj,l.JJ,l.JL,l.sg,l.u,C.w9,C.jq,D,R.R,h.Ov],styles:[".create-post__title{font-size:24px;font-weight:700;color:#152536;letter-spacing:.02em;margin-bottom:32px}.create-post__subtitle{font-size:16px;font-weight:600;color:#152536cc;letter-spacing:.02em;margin-bottom:24px}.create-post__footer{margin-top:24px;display:flex;justify-content:flex-end}.create-post__button{width:auto;height:40px}\n"],encapsulation:2});var Ct=a(6169);const j=function(n){return{backgroundColor:n}};function wt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",15),t._UZ(1,"div",16),t.TgZ(2,"div",17)(3,"div",18)(4,"div",19),t.NdJ("click",function(){const r=t.CHM(e).$implicit,u=t.oxw(3);return t.KtG(u.navigateSubcategory(r))}),t._uU(5),t.qZA(),t.TgZ(6,"div",20),t._uU(7),t.qZA()(),t.TgZ(8,"div",21),t._uU(9),t.qZA()()()}if(2&n){const e=o.$implicit,i=o.index,s=t.oxw(3);t.xp6(1),t.Q6J("ngStyle",t.VKq(4,j,s.getColor(i))),t.xp6(4),t.hij(" ",null==e?null:e.title," "),t.xp6(2),t.hij(" ",s.formatDate(null==e?null:e.updated_at)," "),t.xp6(2),t.hij(" ",null==e?null:e.description," ")}}function xt(n,o){if(1&n&&t.YNc(0,wt,10,6,"div",14),2&n){const e=t.oxw(2);t.Q6J("ngForOf",null==e.category?null:e.category.sub_categories)}}function St(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",22)(1,"p",23),t._uU(2,"\u041f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"),t.qZA(),t.TgZ(3,"div",24),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.navigateForm("subcategory"))}),t._uU(4," \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u0443\u044e "),t.qZA()()}}function Tt(n,o){if(1&n&&(t.YNc(0,xt,1,1,"ng-template",13),t.YNc(1,St,5,0,"ng-template",13)),2&n){const e=t.oxw();t.Q6J("ngIf",null==e.category||null==e.category.sub_categories?null:e.category.sub_categories.length),t.xp6(1),t.Q6J("ngIf",!(null!=e.category&&null!=e.category.sub_categories&&e.category.sub_categories.length))}}function Zt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",15),t._UZ(1,"div",16),t.TgZ(2,"div",17)(3,"div",18)(4,"div",19),t.NdJ("click",function(){const r=t.CHM(e).$implicit,u=t.oxw(3);return t.KtG(u.navigatePost(null==r?null:r.id))}),t._uU(5),t.qZA(),t.TgZ(6,"div",20),t._uU(7),t.qZA()(),t._UZ(8,"div",26),t.qZA()()}if(2&n){const e=o.$implicit,i=o.index,s=t.oxw(3);t.xp6(1),t.Q6J("ngStyle",t.VKq(4,j,s.getColor(i))),t.xp6(4),t.hij(" ",null==e?null:e.title," "),t.xp6(2),t.hij(" ",s.formatDate(null==e?null:e.updated_at)," "),t.xp6(1),t.Q6J("innerHTML",null==e?null:e.description,t.oJD)}}function Et(n,o){if(1&n&&t.YNc(0,Zt,9,6,"div",14),2&n){const e=t.oxw(2);t.Q6J("ngForOf",null==e.category?null:e.category.posts)}}function Mt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",22)(1,"p",23),t._uU(2,"\u041f\u043e\u0441\u0442\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"),t.qZA(),t.TgZ(3,"div",24),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.navigateForm("post"))}),t._uU(4," \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u0443\u044e "),t.qZA()()}}function It(n,o){if(1&n&&(t.TgZ(0,"bb-loader",25),t.YNc(1,Et,1,1,"ng-template",13),t.YNc(2,Mt,5,0,"ng-template",13),t.qZA()),2&n){const e=t.oxw();t.Q6J("loading",e.isSubcategoryLoading),t.xp6(1),t.Q6J("ngIf",null==e.category||null==e.category.posts?null:e.category.posts.length),t.xp6(1),t.Q6J("ngIf",!(null!=e.category&&null!=e.category.posts&&e.category.posts.length))}}class S{constructor(o,e,i,s,r,u){this.categoryService=o,this.route=e,this.router=i,this.changeDetector=s,this.toastr=r,this.modalService=u,this.isSubcategoryLoading=!1}ngOnInit(){this.route.params.subscribe(o=>{this.subscription&&(this.category=null),this.type=o.type,this.categoryId=o.id,"category"===this.type?this.getCategory(this.categoryId):"subcategory"===this.type&&this.getSubcategoryById()})}getColor(o){return(0,c.C0)(o)}formatDate(o){return o?(0,c.F8)(o):""}getCategory(o){this.subscription=this.categoryService.categoryList$.subscribe(e=>{e.length&&(this.category=e.find(i=>i.id==o),this.changeDetector.detectChanges())})}navigateForm(o){"subcategory"===o?this.router.navigate(["categories/create/subcategory"],{queryParams:{category:this.categoryId}}):"post"===o&&this.router.navigate(["categories/article/create"],{queryParams:{subcategory:this.categoryId,category:this.category?.category_id}})}getSubcategoryById(){this.isSubcategoryLoading=!0,this.changeDetector.detectChanges(),this.categoryService.getSubcategoryById(this.categoryId).subscribe({next:o=>{this.category=o?.sub_category,this.isSubcategoryLoading=!1,this.changeDetector.detectChanges()},error:o=>{(0,c.N3)(o,this.toastr),this.isSubcategoryLoading=!1,this.changeDetector.detectChanges()}})}navigatePost(o){this.router.navigate(["/posts/post/"+o])}navigateBack(){this.router.navigate("subcategory"===this.type?["/categories/list/category/"+this.category?.category_id]:["/home"])}navigateEdit(){this.router.navigate([`/categories/edit/${this.type}/${this.categoryId}`])}navigateSubcategory(o){this.router.navigate(["/categories/list/subcategory/"+o.id])}deleteHandler(){const o=this.modalService.open(Ct.Y,{centered:!0}),e=s=>{this.navigateBack(),(0,c.PE)(`${"subcategory"===this.type?"\u041f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f":"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"} "${this.category.title}" \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d\u0430`,this.toastr),this.categoryService.getCategoryList()},i=s=>{(0,c.N3)(s,this.toastr)};o.componentInstance.message=`\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c ${"subcategory"===this.type?"\u043f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e":"\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e"} "${this.category.title}"?`,o.result.then(s=>{s&&("subcategory"===this.type?this.categoryService.deleteSubcategoryById(this.categoryId).subscribe({next:e,error:i}):this.categoryService.deleteCategoryById(this.categoryId).subscribe({next:e,error:i}))})}}S.\u0275fac=function(o){return new(o||S)(t.Y36(I.H),t.Y36(f.gz),t.Y36(f.F0),t.Y36(t.sBO),t.Y36(T._W),t.Y36(Z.FF))},S.\u0275cmp=t.Xpm({type:S,selectors:[["bb-category-list"]],decls:26,vars:4,consts:[[1,"container-wrapper"],[1,"list"],[1,"list-header"],[1,"list-header__left","pointer",3,"click"],["src","./assets/icons/arrow_left_green.svg","alt",""],[1,"list-header__right"],[1,"pointer",3,"click"],["src","./assets/icons/add_green.svg","alt",""],["src","./assets/icons/edit_green.svg","alt",""],["src","./assets/icons/delete_urn_green.svg","alt",""],[1,"list-body"],[1,"list-title"],[1,"list-wrapper"],[3,"ngIf"],["class","list-item",4,"ngFor","ngForOf"],[1,"list-item"],[1,"list-item__filled",3,"ngStyle"],[1,"list-item__body"],[1,"list-item__header"],[1,"list-item__text","hover",3,"click"],[1,"list-item__time"],[1,"list-item__description"],[1,"list-not-found"],[1,"title"],[1,"add-new",3,"click"],[3,"loading"],[1,"list-item__description",3,"innerHTML"]],template:function(o,e){if(1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t.NdJ("click",function(){return e.navigateBack()}),t.TgZ(4,"span"),t._UZ(5,"img",4),t.qZA(),t._uU(6),t.qZA(),t.TgZ(7,"div",5)(8,"div",6),t.NdJ("click",function(){return e.navigateForm("subcategory"===e.type?"post":"subcategory")}),t.TgZ(9,"span"),t._UZ(10,"img",7),t.qZA(),t._uU(11," \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c "),t.qZA(),t.TgZ(12,"div",6),t.NdJ("click",function(){return e.navigateEdit()}),t.TgZ(13,"span"),t._UZ(14,"img",8),t.qZA(),t._uU(15," \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c "),t.qZA(),t.TgZ(16,"div",6),t.NdJ("click",function(){return e.deleteHandler()}),t.TgZ(17,"span"),t._UZ(18,"img",9),t.qZA(),t._uU(19," \u0423\u0434\u0430\u043b\u0438\u0442\u044c "),t.qZA()()(),t.TgZ(20,"div",10)(21,"h3",11),t._uU(22),t.qZA(),t.TgZ(23,"div",12),t.YNc(24,Tt,2,2,"ng-template",13),t.YNc(25,It,3,3,"ng-template",13),t.qZA()()()()),2&o){let i;t.xp6(6),t.hij(" ","subcategory"===e.type?null==(i=e.categoryService.getCategoryById(null==e.category?null:e.category.category_id))?null:i.title:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"," "),t.xp6(16),t.Oqu(null==e.category?null:e.category.title),t.xp6(2),t.Q6J("ngIf","category"===e.type),t.xp6(1),t.Q6J("ngIf","subcategory"===e.type)}},dependencies:[h.sg,h.O5,h.PC,R.R],styles:[".list-header[_ngcontent-%COMP%]{padding-bottom:16px;padding-left:32px;padding-right:32px;margin:-16px -32px 16px;display:flex;align-items:center;justify-content:space-between;color:#2ab514;border-bottom:1px #f3f3f3 solid;flex-wrap:wrap}.list-header__right[_ngcontent-%COMP%], .list-header__left[_ngcontent-%COMP%]{display:flex;align-items:flex-end}.list-header__right[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .list-header__left[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px;height:20px}.list-header__right[_ngcontent-%COMP%]{gap:20px}.list-header__left[_ngcontent-%COMP%]{gap:12px}.list-title[_ngcontent-%COMP%]{font-weight:600;font-size:24px;margin-bottom:24px}.list-item[_ngcontent-%COMP%]{display:flex;gap:16px;justify-content:space-between;align-items:center;min-height:100px}.list-item[_ngcontent-%COMP%]:not(:last-child){margin-bottom:16px}.list-item__filled[_ngcontent-%COMP%]{height:100px;min-width:100px;border-radius:8px}.list-item__body[_ngcontent-%COMP%]{width:100%;align-self:flex-start}.list-item__header[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between}.list-item__text[_ngcontent-%COMP%]{font-weight:600;font-size:16px;display:-webkit-box;max-width:100%;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.list-item__description[_ngcontent-%COMP%], .list-item__time[_ngcontent-%COMP%]{color:#505c64;font-weight:500;font-size:14px}.list-item__description[_ngcontent-%COMP%]{display:-webkit-box;max-width:80%;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.list-not-found[_ngcontent-%COMP%]{text-align:center}.list-not-found[_ngcontent-%COMP%]   .add-new[_ngcontent-%COMP%]{margin-top:8px;cursor:pointer;color:#50c55a}.hover[_ngcontent-%COMP%]:hover{opacity:.7;cursor:pointer}.pointer[_ngcontent-%COMP%]{cursor:pointer}@media screen and (max-width: 568px){.list-item__filled[_ngcontent-%COMP%]{height:60px;min-width:60px}}"]});var Pt=a(4466);const Dt=[{path:"create/:type",component:b},{path:"edit/:type/:id",component:b},{path:"article/:action/:id",component:_},{path:"article/:action",component:_},{path:"list/:type/:id",component:S}];class y{}y.\u0275fac=function(o){return new(o||y)},y.\u0275mod=t.oAB({type:y}),y.\u0275inj=t.cJS({imports:[h.ez,f.Bz.forChild(Dt),l.UX,C.A0,l.u5,_t,Pt.m]})}}]);