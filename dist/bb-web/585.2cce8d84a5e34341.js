"use strict";(self.webpackChunkbb_web=self.webpackChunkbb_web||[]).push([[585],{5585:(J,C,r)=>{r.r(C),r.d(C,{PostModule:()=>d});var m=r(8692),a=r(7553),t=r(4537),P=r(5497),v=r(8247);function y(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"td",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,u=t.oxw();return t.KtG(u.navigateVersion(null==i?null:i.id))}),t._uU(1," \u041f\u0435\u0440\u0435\u0439\u0442\u0438 "),t.qZA()}}function Z(o,n){1&o&&(t.TgZ(0,"td",9),t._uU(1,"\u0410\u043a\u0442\u0438\u0432\u043d\u0430\u044f"),t.qZA())}function O(o,n){if(1&o&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.YNc(7,y,2,0,"td",12),t.YNc(8,Z,2,0,"td",13),t.qZA()),2&o){const e=n.$implicit;t.xp6(2),t.Oqu(null==e?null:e.id),t.xp6(2),t.Oqu(null==e?null:e.created_by),t.xp6(2),t.Oqu(null==e?null:e.title),t.xp6(1),t.Q6J("ngIf",!(null!=e&&e.is_current)),t.xp6(1),t.Q6J("ngIf",null==e?null:e.is_current)}}class g{constructor(n,e){this.activeModal=n,this.router=e}close(){this.activeModal.close()}navigateVersion(n){this.router.navigate(["/posts/post-version/"+n]),this.close()}}g.\u0275fac=function(n){return new(n||g)(t.Y36(P.Kz),t.Y36(v.F0))},g.\u0275cmp=t.Xpm({type:g,selectors:[["bb-post-versions"]],inputs:{postHistoryList:"postHistoryList",activePost:"activePost"},decls:45,vars:5,consts:[[1,"modal-header"],[1,"modal__title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"version-active"],[1,"version-subtitle"],[1,"version-table"],[1,"table","table-stripped"],["scope","col"],[1,"active"],[1,"version-list"],[4,"ngFor","ngForOf"],["class","redirect",3,"click",4,"ngIf"],["class","active",4,"ngIf"],[1,"redirect",3,"click"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"h4",1),t._uU(2),t.qZA(),t.TgZ(3,"button",2),t.NdJ("click",function(){return e.close()}),t.qZA()(),t.TgZ(4,"div",3)(5,"div",4)(6,"div",5),t._uU(7,"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f"),t.qZA(),t.TgZ(8,"div",6)(9,"table",7)(10,"thead")(11,"tr")(12,"th",8),t._uU(13,"\u0412\u0435\u0440\u0441\u0438\u044f"),t.qZA(),t.TgZ(14,"th",8),t._uU(15,"\u0410\u0432\u0442\u043e\u0440"),t.qZA(),t.TgZ(16,"th",8),t._uU(17,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"),t.qZA(),t._UZ(18,"th",8),t.qZA()(),t.TgZ(19,"tbody")(20,"tr")(21,"td"),t._uU(22),t.qZA(),t.TgZ(23,"td"),t._uU(24),t.qZA(),t.TgZ(25,"td"),t._uU(26),t.qZA(),t.TgZ(27,"td",9),t._uU(28,"\u0410\u043a\u0442\u0438\u0432\u043d\u0430\u044f"),t.qZA()()()()()(),t.TgZ(29,"div",10)(30,"div",5),t._uU(31,"\u0412\u0441\u0435 \u0432\u0435\u0440\u0441\u0438\u0438"),t.qZA(),t.TgZ(32,"div",6)(33,"table",7)(34,"thead")(35,"tr")(36,"th",8),t._uU(37,"\u0412\u0435\u0440\u0441\u0438\u044f"),t.qZA(),t.TgZ(38,"th",8),t._uU(39,"\u0410\u0432\u0442\u043e\u0440"),t.qZA(),t.TgZ(40,"th",8),t._uU(41,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"),t.qZA(),t._UZ(42,"th",8),t.qZA()(),t.TgZ(43,"tbody"),t.YNc(44,O,9,5,"tr",11),t.qZA()()()()()),2&n&&(t.xp6(2),t.hij(' \u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u043f\u043e\u0441\u0442\u0430 "',null==e.activePost?null:e.activePost.title,'" '),t.xp6(20),t.Oqu(null==e.activePost?null:e.activePost.id),t.xp6(2),t.Oqu(null==e.activePost?null:e.activePost.created_by),t.xp6(2),t.Oqu(null==e.activePost?null:e.activePost.title),t.xp6(18),t.Q6J("ngForOf",e.postHistoryList))},dependencies:[m.sg,m.O5],styles:[".modal-header[_ngcontent-%COMP%]{padding:24px}.modal-body[_ngcontent-%COMP%]{padding:16px 24px 24px;margin-bottom:32px}.version-active[_ngcontent-%COMP%]{padding-bottom:12px;border-bottom:2px solid #000}.version-list[_ngcontent-%COMP%]{padding-top:16px}.version-subtitle[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#152536;letter-spacing:.02em;margin-bottom:16px}.version-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.version-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{padding:12px}.version-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:none!important}.version-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(1){width:20%}.version-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){width:20%}.version-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){width:50%}.version-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4){width:10%}.version-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none!important}.active[_ngcontent-%COMP%]{color:#2ab514!important}.redirect[_ngcontent-%COMP%]{color:#0d6efd;cursor:pointer}.redirect[_ngcontent-%COMP%]:hover{opacity:.7}"]});var M=r(4135),T=r(9923),A=r(8292),x=r(6943),F=r(3942);class U{constructor(n,e,s){this.appRef=n,this.factory=e,this.injector=s,this.embeddedComponents=[]}create(n){const s=Array.prototype.slice.call(n.querySelectorAll(this.factory.selector)).map(i=>this.createComponent(i));return this.embeddedComponents.push(...s),s.forEach(i=>this.appRef.attachView(i.hostView)),s}createComponent(n){const e=[Array.prototype.slice.call(n.childNodes)],s=this.factory.create(this.injector,e,n);return this.setComponentAttrs(s.instance,n),s}setComponentAttrs(n,e){const s=n;for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&e.hasAttribute(i)&&(s[i]=e.getAttribute(i))}destroy(){this.embeddedComponents.forEach(n=>this.appRef.detachView(n.hostView)),this.embeddedComponents.forEach(n=>n.destroy())}}class c{constructor(n,e,s){this.appRef=n,this.injector=e,this.resolver=s}create(n){const e=this.resolver.resolveComponentFactory(n);return new U(this.appRef,e,this.injector)}}c.\u0275fac=function(n){return new(n||c)(t.LFG(t.z2F),t.LFG(t.zs3),t.LFG(t._Vd))},c.\u0275prov=t.Yz7({token:c,factory:c.\u0275fac});class l{constructor(){}ngOnInit(){console.log(this.value)}}l.\u0275fac=function(n){return new(n||l)},l.\u0275cmp=t.Xpm({type:l,selectors:[["bb-variable"]],inputs:{value:"value",name:"name",id:"id"},decls:2,vars:1,consts:[[1,"variable"]],template:function(n,e){1&n&&(t.TgZ(0,"strong",0),t._uU(1),t.qZA()),2&n&&(t.xp6(1),t.Oqu(e.value))},styles:[".variable[_ngcontent-%COMP%]{background-color:#ff0}"]});class h{constructor(n,e){this.cmpFactory=n,this.factories=[],this.components=[l],this.hostElement=e.nativeElement}ngAfterViewInit(){this.hostElement.innerHTML=this.html,this.initFactories(),this.createAllComponents()}initFactories(){this.components.forEach(n=>{const e=this.cmpFactory.create(n);this.factories.push(e)})}createAllComponents(){const n=this.hostElement,e=[];this.factories.forEach(s=>{const i=s.create(n);e.push(...i),console.log(s),e.filter(u=>u.instance instanceof l).forEach(u=>{console.log(u);const f=u.location.nativeElement.attributes.var.value,_=this.variables.find(b=>b?.id===Number(f));u.instance.value=_?.value,u.instance.name=_?.name,u.instance.id=_?.id})})}removeAllComponents(){this.factories.forEach(n=>n.destroy())}ngOnDestroy(){this.removeAllComponents()}}function q(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.openVersions())}),t.TgZ(1,"span"),t._UZ(2,"img",22),t.qZA(),t._uU(3," \u0412\u0435\u0440\u0441\u0438\u0438 "),t.qZA()}}function V(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.navigateEditPost())}),t.TgZ(1,"span"),t._UZ(2,"img",23),t.qZA(),t._uU(3," \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c "),t.qZA()}}function D(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.revertPostVersion())}),t.TgZ(1,"span"),t._UZ(2,"img",23),t.qZA(),t._uU(3," \u0412\u0435\u0440\u043d\u0443\u0442\u044c "),t.qZA()}}function N(o,n){if(1&o&&(t.TgZ(0,"h2"),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.hij(" \u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 (\u0412\u0435\u0440\u0441\u0438\u044f - ",null==e.post?null:e.post.id,") ")}}function I(o,n){if(1&o&&t._UZ(0,"div",24),2&o){const e=t.oxw();t.Q6J("innerHTML",null==e.post?null:e.post.content,t.oJD)}}function E(o,n){if(1&o&&t._UZ(0,"bb-binder",25),2&o){const e=t.oxw();t.Q6J("html",null==e.post?null:e.post.content)("variables",e.variables)}}h.\u0275fac=function(n){return new(n||h)(t.Y36(c,2),t.Y36(t.SBq))},h.\u0275cmp=t.Xpm({type:h,selectors:[["bb-binder"]],inputs:{html:"html",variables:"variables"},features:[t._Bn([c])],decls:0,vars:0,template:function(n,e){},encapsulation:2});class p{constructor(n,e,s,i,u,f,_,b,B){this.changeDetector=n,this.route=e,this.router=s,this.postService=i,this.variableService=u,this.toastr=f,this.categoryService=_,this.modalService=b,this.helperService=B,this.isPostLoading=!1,this.variables=[],this.postHistory=[],this.isVersionPost=!1,this.users=[]}ngOnInit(){"post-version"===this.router.url.split("/")[2]&&(this.isVersionPost=!0,this.changeDetector.detectChanges()),this.route.params.subscribe(n=>{this.id=n.id,this.isVersionPost?this.getPostVersionById():this.getPostById()})}getPostById(){this.isPostLoading=!0,this.changeDetector.detectChanges(),this.postService.getPostById(this.id).subscribe({next:n=>{this.post=n.posts,this.postHistory=n.post_histories;let e=[];e.push(Number(this.post.created_by)),e.includes(Number(this.post?.updated_by))||e.push(Number(this.post?.updated_by)),this.getUsersById(e),this.getVariables(JSON.parse(this.post.variable_ids))},error:n=>{this.isPostLoading=!1,this.changeDetector.detectChanges(),(0,a.N3)(n,this.toastr)}})}getVariables(n){this.variableService.getVariablesByIds({ids:n}).subscribe({next:s=>{this.variables=s.vars,this.isPostLoading=!1,this.changeDetector.detectChanges()},error:s=>{(0,a.N3)(s,this.toastr),this.isPostLoading=!1,this.changeDetector.detectChanges()}})}navigateSubcategory(){this.router.navigate(["categories/list/subcategory/"+this.post?.sub_category_id])}navigateEditPost(){this.router.navigate(["categories/article/edit/"+this.id])}navigatePost(n){this.router.navigate(["/posts/post/"+n])}openVersions(){const n=this.modalService.open(g,{scrollable:!0,modalDialogClass:"mw-1020",centered:!0});n.componentInstance.postHistoryList=this.postHistory,n.componentInstance.activePost=this.postHistory.find(e=>1===e.is_current)}getPostVersionById(){this.isPostLoading=!0,this.changeDetector.detectChanges(),this.postService.getPostVersionById(this.id).subscribe({next:n=>{this.post=n.posts;let e=[];e.push(Number(this.post.created_by)),e.includes(Number(this.post?.updated_by))||e.push(Number(this.post?.updated_by)),this.getUsersById(e),this.getVariables(JSON.parse(this.post.variable_ids))},error:n=>{this.isPostLoading=!1,this.changeDetector.detectChanges(),(0,a.N3)(n,this.toastr)}})}revertPostVersion(){this.postService.revertPostVersion({post_id:this.post.post_id,post_history_id:this.post.id}).subscribe({next:e=>{this.navigatePost(e?.posts.id)},error:e=>{(0,a.N3)(e,this.toastr)}})}getUsersById(n){this.helperService.getUsersByIds(n).subscribe({next:e=>{this.users=e?.users,this.changeDetector.detectChanges()},error:e=>{(0,a.N3)(e,this.toastr)}})}getUserName(n){return this.users.length?this.users.find(e=>e.id===n)?.name:""}formatDate(n){return n?(0,a.F8)(n):""}}p.\u0275fac=function(n){return new(n||p)(t.Y36(t.sBO),t.Y36(v.gz),t.Y36(v.F0),t.Y36(M.L),t.Y36(T.S),t.Y36(A._W),t.Y36(x.H),t.Y36(P.FF),t.Y36(F.W))},p.\u0275cmp=t.Xpm({type:p,selectors:[["bb-post"]],decls:39,vars:11,consts:[[1,"row"],[1,"col-9"],[1,"post"],[1,"post-header"],[1,"post-header__left","pointer",3,"click"],["src","./assets/icons/arrow_left_green.svg","alt",""],[1,"post-header__right"],["class","pointer",3,"click",4,"ngIf"],[1,"post-body"],[4,"ngIf"],[1,"post-title"],[3,"innerHTML",4,"ngIf"],[3,"html","variables",4,"ngIf"],[1,"col-3"],[1,"info"],[1,"info-header"],[1,"info-title"],[1,"info-body"],[1,"info-item"],[1,"info-subtitle"],[1,"info-text"],[1,"pointer",3,"click"],["src","./assets/icons/clock_green.svg","alt",""],["src","./assets/icons/edit_green.svg","alt",""],[3,"innerHTML"],[3,"html","variables"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),t.NdJ("click",function(){return e.navigateSubcategory()}),t.TgZ(5,"span"),t._UZ(6,"img",5),t.qZA(),t._uU(7),t.qZA(),t.TgZ(8,"div",6),t.YNc(9,q,4,0,"div",7),t.YNc(10,V,4,0,"div",7),t.YNc(11,D,4,0,"div",7),t.qZA()(),t.TgZ(12,"div",8),t.YNc(13,N,2,1,"h2",9),t.TgZ(14,"h2",10),t._uU(15),t.qZA(),t.YNc(16,I,1,1,"div",11),t.YNc(17,E,1,2,"bb-binder",12),t.qZA()()(),t.TgZ(18,"div",13)(19,"div",14)(20,"div",15)(21,"p",16),t._uU(22,"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f"),t.qZA()(),t.TgZ(23,"div",17)(24,"div",18)(25,"p",19),t._uU(26,"\u0410\u0432\u0442\u043e\u0440"),t.qZA(),t.TgZ(27,"p",20),t._uU(28),t.qZA()(),t.TgZ(29,"div",18)(30,"p",19),t._uU(31,"\u0414\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f"),t.qZA(),t.TgZ(32,"p",20),t._uU(33),t.qZA()(),t.TgZ(34,"div",18)(35,"p",19),t._uU(36,"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435"),t.qZA(),t.TgZ(37,"p",20),t._uU(38),t.qZA()()()()()()),2&n&&(t.xp6(7),t.hij(" ",e.categoryService.getSubcatecoryNameById(null==e.post?null:e.post.sub_category_id)," "),t.xp6(2),t.Q6J("ngIf",!e.isVersionPost),t.xp6(1),t.Q6J("ngIf",!e.isVersionPost),t.xp6(1),t.Q6J("ngIf",e.isVersionPost),t.xp6(2),t.Q6J("ngIf",e.isVersionPost),t.xp6(2),t.hij(" ",null==e.post?null:e.post.title," "),t.xp6(1),t.Q6J("ngIf",0===e.variables.length&&(null==e.post?null:e.post.content)&&!e.isPostLoading),t.xp6(1),t.Q6J("ngIf",e.variables.length>0),t.xp6(11),t.Oqu(e.getUserName(null==e.post?null:e.post.created_by)),t.xp6(5),t.Oqu(e.formatDate(null==e.post?null:e.post.created_at)),t.xp6(5),t.Oqu(e.formatDate(null==e.post?null:e.post.updated_at)))},dependencies:[m.O5,h],styles:[".post[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px}.post-header[_ngcontent-%COMP%]{padding:16px 32px;display:flex;align-items:center;justify-content:space-between;color:#2ab514;border-bottom:1px #f3f3f3 solid}.post-header__right[_ngcontent-%COMP%], .post-header__left[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:12px}.post-header__right[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .post-header__left[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px;height:20px}.post-body[_ngcontent-%COMP%]{padding:16px 32px 32px}.post-title[_ngcontent-%COMP%]{margin-bottom:24px}.info[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px}.info-header[_ngcontent-%COMP%]{background-color:#d7d7d7;padding:8px 16px}.info-body[_ngcontent-%COMP%]{padding:8px 16px}.info-item[_ngcontent-%COMP%]{padding:12px 0;border-bottom:1px solid #f3f3f3}.info-item[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none}.info-text[_ngcontent-%COMP%]{margin-left:12px}.info-title[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.info-subtitle[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.variable[_ngcontent-%COMP%]{background-color:#ff0}.pointer[_ngcontent-%COMP%]{cursor:pointer}"]});var w=r(4466);const Y=[{path:"post/:id",component:p},{path:"post-version/:id",component:p}];class d{}d.\u0275fac=function(n){return new(n||d)},d.\u0275mod=t.oAB({type:d}),d.\u0275inj=t.cJS({imports:[m.ez,v.Bz.forChild(Y),w.m]})}}]);